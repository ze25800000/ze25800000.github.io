<!doctype html>
<html lang="en">
    <head>
		
        <meta http-equiv="Content-Type" content="text/html" charset="UTF-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
        <meta name="description" content="">
        <link rel="shortcut icon" href="http://p0mvyl5ro.bkt.clouddn.com/timg%20%281%29.gif"/>
        <link rel="canonical" href="http://guolinn.com/">
        <link rel="alternate" type="application/rss+xml" title="Zia Yang" href="">
        <title>node学习笔记 | 超频散热</title>
        <meta name="description" content="{{meta_description}}">

        <link href="//cdn.bootcss.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet">
        <link rel="stylesheet" type="text/css" href="/styles/crisp.css">
        <meta name="HandheldFriendly" content="True" />
        <meta name="MobileOptimized" content="320" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
        <!--[if lt IE 9]>
        <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
        <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
        <![endif]-->

    </head>
    
		<body class="post-template">
	

        <header id="header">
            <a id="logo" href="/"><img src="http://p0mvyl5ro.bkt.clouddn.com/timg%20%281%29.gif" alt="超频散热" /></a>
            <h1><a href="/">Zia Yang</a></h1>
            <p>学习笔记</p>
            <div id="follow-icons">
          <a href="http://github.com/ze25800000"><i class="fa fa-github-square fa-2x"></i></a>
          <a href="http://twitter.com/YzzzzzzE"><i class="fa fa-twitter-square fa-2x"></i></a>
      </div>
<h6><a href="/about">About</a></h6>
        </header>

        <main id="content">
        

<article class="post">
  一月 4, 2017
  
    <span class="taglist">  &middot; 
    
    
      <a href='/tags/node/'>node</a> 
    
    </span>
  

  <h1 class="post-title">node学习笔记</h1>
  <section class="post-content article-entry">
    <h4 id="node"><a href="#node" class="headerlink" title="node"></a>node</h4><ul>
<li><p>首先，Node不为每个用户开辟一个线程，所以非常极端的选择了单线程。单线程，要照顾所有的用户，那么就必须有非阻塞I/O，否则一个人的I/O就把别人、自己都阻塞了。一旦有非阻塞I/O，一个人如果I/O去了，就会放弃CPU的使用权，换成另一个人使用CPU（或者执行此人后面的语句）。所以CPU的利用率100%。第一个人I/O结束了，就要用事件来通知线程，执行回调函数。此时必须有事件环，就有一个排队调度机制。Node中有超过半数的C++代码，在搭建事件环。</p>
</li>
<li><p>Node.js和别的老牌3P不一样：</p>
<ol>
<li>没有自己的语法，使用V8引擎，所以就是JS。V8引擎解析JS的，效率非常高，并且V8中很多东西都是异步的。Node就是将V8中的一些功能自己没有重写（别人做了，自己就站在巨人肩膀上），移植到了服务器上。</li>
<li>没有web容器，就是安装配置完成之后，没有一个根目录。</li>
</ol>
</li>
</ul>
<p>http–协议<br><br>request  请求&lt;–输入的信息<br><br>response 响应–&gt;输出给浏览器信息</p>
<h4 id="fs模块–File-Systerm文件系统"><a href="#fs模块–File-Systerm文件系统" class="headerlink" title="fs模块–File Systerm文件系统"></a>fs模块–File Systerm文件系统</h4><p>fs<br>异步vs同步<br></p>
<ul>
<li>异步–多个操作同时进行,前一个操作没完成,后面的也能开始</li>
<li>同步–一次一个<br></li>
</ul>
<p>fs.readFile(文件名, (错误err, 文件内容) =&gt; {})<br><br>writeFile(文件名,内容,(err)=&gt;{})<br></p>
<h4 id="数据请求"><a href="#数据请求" class="headerlink" title="数据请求"></a>数据请求</h4><p>前台数据请求—form ajax jsonp<br><br>后台-&gt;一样,只是接受了http请求<br><br>前后台只通过http协议传输<br></p>
<h5 id="请求方式"><a href="#请求方式" class="headerlink" title="请求方式:"></a>请求方式:</h5><ol>
<li>GET   数据在url中一起传输</li>
<li>POST  数据不在url里,post数据比get数据大的多</li>
</ol>
<p>req.url ==&gt; /aaa?user=123123123&amp;pass=123123123123</p>
<hr>
<h5 id="GET数据解析"><a href="#GET数据解析" class="headerlink" title="GET数据解析"></a>GET数据解析</h5><ol>
<li><p>自己动手split</p>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">const http = require(&apos;http&apos;);</span><br><span class="line">var server = http.createServer(function (req, res) &#123;</span><br><span class="line">    var GET = &#123;&#125;;</span><br><span class="line">    if (req.url.indexOf(&apos;?&apos;)&gt;-1) &#123;</span><br><span class="line">        var arr1 = req.url.split(&apos;?&apos;);</span><br><span class="line">        var arr2 = arr1[1].split(&apos;&amp;&apos;);</span><br><span class="line">        for (var i = 0; i &lt; arr2.length; i++) &#123;</span><br><span class="line">            var arr3 = arr2[i].split(&apos;=&apos;);</span><br><span class="line">            GET[arr3[0]] = arr3[1];</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    console.log(req.url, GET);</span><br><span class="line">    res.write(&apos;123&apos;);</span><br><span class="line">    res.end();</span><br><span class="line"></span><br><span class="line">&#125;).listen(8080);</span><br></pre></td></tr></table></figure>
</li>
<li><p>querystring</p>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">const http = require(&apos;http&apos;);</span><br><span class="line">const querystring = require(&apos;querystring&apos;);</span><br><span class="line"></span><br><span class="line">var server = http.createServer(function (req, res) &#123;</span><br><span class="line">    var GET = querystring.parse(req.url.split(&apos;?&apos;)[1]);</span><br><span class="line">    console.log(req.url, GET);</span><br><span class="line">    res.write(&apos;123&apos;);</span><br><span class="line">    res.end();</span><br><span class="line"></span><br><span class="line">&#125;).listen(8080);</span><br></pre></td></tr></table></figure>
</li>
<li><p>url</p>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">const http = require(&apos;http&apos;);</span><br><span class="line">const urllib = require(&apos;url&apos;);</span><br><span class="line"></span><br><span class="line">var server = http.createServer(function (req, res) &#123;</span><br><span class="line">    var GET = urllib.parse(req.url, true).query;</span><br><span class="line">    console.log(req.url, GET);</span><br><span class="line">    res.write(&apos;123&apos;);</span><br><span class="line">    res.end();</span><br><span class="line"></span><br><span class="line">&#125;).listen(8080);</span><br></pre></td></tr></table></figure>
</li>
</ol>
<h5 id="POST数据解析"><a href="#POST数据解析" class="headerlink" title="POST数据解析"></a>POST数据解析</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">//data有一段数据到达(发生很多次)</span><br><span class="line">var str = &quot;&quot;;</span><br><span class="line">var i = 0;</span><br><span class="line">req.on(&apos;data&apos;, function (data) &#123;</span><br><span class="line">    console.log(`第$&#123;i++&#125;次`);</span><br><span class="line">    str += data;</span><br><span class="line">&#125;);</span><br><span class="line">//end 数据全部到达(只发生一次)</span><br><span class="line">req.on(&apos;end&apos;, function () &#123;</span><br><span class="line">    console.log(str);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<h5 id="综合"><a href="#综合" class="headerlink" title="综合"></a>综合</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line">const http=require(&apos;http&apos;);</span><br><span class="line">const fs=require(&apos;fs&apos;);</span><br><span class="line">const querystring=require(&apos;querystring&apos;);</span><br><span class="line">const urlLib=require(&apos;url&apos;);</span><br><span class="line"></span><br><span class="line">var server=http.createServer(function (req, res)&#123;</span><br><span class="line">  //GET</span><br><span class="line">  var obj=urlLib.parse(req.url, true);</span><br><span class="line"></span><br><span class="line">  var url=obj.pathname;</span><br><span class="line">  const GET=obj.query;</span><br><span class="line"></span><br><span class="line">  //POST</span><br><span class="line">  var str=&apos;&apos;;</span><br><span class="line">  req.on(&apos;data&apos;, function (data)&#123;</span><br><span class="line">    str+=data;</span><br><span class="line">  &#125;);</span><br><span class="line">  req.on(&apos;end&apos;, function ()&#123;</span><br><span class="line">    const POST=querystring.parse(str);</span><br><span class="line"></span><br><span class="line">    /*</span><br><span class="line">    url——要什么</span><br><span class="line">    GET——get数据</span><br><span class="line">    POST——post数据</span><br><span class="line">    */</span><br><span class="line"></span><br><span class="line">    //文件请求</span><br><span class="line">    var file_name=&apos;./www&apos;+url;</span><br><span class="line">    fs.readFile(file_name, function (err, data)&#123;</span><br><span class="line">      if(err)&#123;</span><br><span class="line">        res.write(&apos;404&apos;);</span><br><span class="line">      &#125;else&#123;</span><br><span class="line">        res.write(data);</span><br><span class="line">      &#125;</span><br><span class="line">      res.end();</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">server.listen(8081);</span><br></pre></td></tr></table></figure>
<h3 id="案例-登陆注册页"><a href="#案例-登陆注册页" class="headerlink" title="案例:登陆注册页"></a>案例:登陆注册页</h3><p>访问类型分两类</p>
<ol>
<li>对文件的访问<code>http://localhost:8080/1.html</code></li>
<li>对接口的访问<code>http://localhost:8080/user?act=login</code></li>
</ol>
<hr>
<ol>
<li><p>server.js</p>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><span class="line">const http = require(&apos;http&apos;);</span><br><span class="line">const fs = require(&apos;fs&apos;);</span><br><span class="line">const querystring = require(&apos;querystring&apos;);</span><br><span class="line">const urllib = require(&apos;url&apos;);</span><br><span class="line"></span><br><span class="line">var users = &#123;&#125;;//&#123;用户名1:密码1,用户名2:密码2,用户名3:密码3,&#125;</span><br><span class="line"></span><br><span class="line">http.createServer(function (req, res) &#123;</span><br><span class="line">    //解析数据</span><br><span class="line">    var str = &apos;&apos;;</span><br><span class="line">    req.on(&apos;data&apos;, function (data) &#123;</span><br><span class="line">        str += data;</span><br><span class="line">    &#125;);</span><br><span class="line">    req.on(&apos;end&apos;, function (data) &#123;</span><br><span class="line">        var obj = urllib.parse(req.url, true);</span><br><span class="line"></span><br><span class="line">        const url = obj.pathname;</span><br><span class="line">        const GET = obj.query;</span><br><span class="line">        const POST = querystring.parse(str);</span><br><span class="line"></span><br><span class="line">        if (url == &apos;/user&apos;) &#123;</span><br><span class="line">            switch (GET.act) &#123;</span><br><span class="line">                case &apos;reg&apos;:</span><br><span class="line">                    //1.检查用户是否存在</span><br><span class="line">                    if (users[GET.user]) &#123;</span><br><span class="line">                        res.write(&apos;&#123; &quot;ok&quot;: false, &quot;msg&quot;: &quot;此用户已存在&quot;&#125;&apos;);</span><br><span class="line">                    &#125; else &#123;</span><br><span class="line">                        //2.插入user</span><br><span class="line">                        users[GET.user] = GET.pass;</span><br><span class="line">                        res.write(&apos;&#123; &quot;ok&quot;: true, &quot;msg&quot;: &quot;注册成功&quot;&#125;&apos;);</span><br><span class="line">                    &#125;</span><br><span class="line">                    break;</span><br><span class="line">                case &apos;login&apos;:</span><br><span class="line">                    //1.检查用户是否存在</span><br><span class="line">                    if (users[GET.user] == null) &#123;</span><br><span class="line">                        res.write(&apos;&#123; &quot;ok&quot;: false, &quot;msg&quot;: &quot;此用户不存在&quot;&#125;&apos;);</span><br><span class="line">                    &#125; else if (users[GET.user] != GET.pass) &#123;</span><br><span class="line">                        //2.检查用户密码</span><br><span class="line">                        res.write(&apos;&#123; &quot;ok&quot;: false, &quot;msg&quot;: &quot;用户名或密码有误&quot;&#125;&apos;);</span><br><span class="line">                    &#125; else &#123;</span><br><span class="line">                        res.write(&apos;&#123; &quot;ok&quot;: true, &quot;msg&quot;: &quot;登陆成功&quot;&#125;&apos;);</span><br><span class="line">                    &#125;</span><br><span class="line">                    break;</span><br><span class="line">                default:</span><br><span class="line">                    res.write(&#123;</span><br><span class="line">                        &quot;ok&quot;: false,</span><br><span class="line">                        &quot;msg&quot;: &apos;未知的act&apos;</span><br><span class="line">                    &#125;);</span><br><span class="line">            &#125;</span><br><span class="line">            res.end();</span><br><span class="line">        &#125; else &#123;</span><br><span class="line">            //读取文件</span><br><span class="line">            var file_name = &apos;./www&apos; + url;</span><br><span class="line">            fs.readFile(file_name, function (err, data) &#123;</span><br><span class="line">                if (err) &#123;</span><br><span class="line">                    res.write(&apos;404&apos;);</span><br><span class="line">                &#125; else &#123;</span><br><span class="line">                    res.write(data);</span><br><span class="line">                &#125;</span><br><span class="line">                res.end();</span><br><span class="line">            &#125;);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;).listen(8080);</span><br></pre></td></tr></table></figure>
</li>
<li><p>user.html</p>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line">    &lt;script src=&quot;ajax.js&quot;&gt;&lt;/script&gt;</span><br><span class="line">    &lt;script&gt;</span><br><span class="line">        window.onload = function () &#123;</span><br><span class="line">            var oTxtUser = document.getElementById(&apos;user&apos;);</span><br><span class="line">            var oTxtPass = document.getElementById(&apos;pass&apos;);</span><br><span class="line">            var oBtnReg = document.getElementById(&apos;reg_btn&apos;);</span><br><span class="line">            var oBtnLogin = document.getElementById(&apos;login_btn&apos;);</span><br><span class="line">            oBtnLogin.onclick = function () &#123;</span><br><span class="line">                ajax(&#123;</span><br><span class="line">                    url: &apos;user&apos;,</span><br><span class="line">                    data: &#123;act: &apos;login&apos;, user: oTxtUser.value, pass: oTxtPass.value&#125;,</span><br><span class="line">                    type:&apos;get&apos;,</span><br><span class="line">                    success: function (str) &#123;</span><br><span class="line">                        console.log(str);</span><br><span class="line">                        var json = eval(&apos;(&apos; + str + &apos;)&apos;);</span><br><span class="line">                        if (json.ok) &#123;</span><br><span class="line">                            alert(&apos;登陆成功&apos;);</span><br><span class="line">                        &#125; else &#123;</span><br><span class="line">                            alert(&apos;登陆失败 :&apos; + json.msg);</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;,</span><br><span class="line">                    error: function () &#123;</span><br><span class="line">                        alert(&apos;通信失败&apos;)</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;);</span><br><span class="line">            &#125;;</span><br><span class="line"></span><br><span class="line">            oBtnReg.onclick = function () &#123;</span><br><span class="line">                ajax(&#123;</span><br><span class="line">                    url: &apos;/user&apos;,</span><br><span class="line">                    data: &#123;act: &apos;reg&apos;, user: oTxtUser.value, pass: oTxtPass.value&#125;,</span><br><span class="line">                    type: &apos;get&apos;,</span><br><span class="line">                    success: function (str) &#123;</span><br><span class="line">                        var json = eval(&apos;(&apos; + str + &apos;)&apos;);</span><br><span class="line">                        if (json.ok) &#123;</span><br><span class="line">                            alert(&apos;注册成功&apos;);</span><br><span class="line">                        &#125; else &#123;</span><br><span class="line">                            alert(&apos;注册失败&apos; + json.msg);</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;,</span><br><span class="line">                    error: function () &#123;</span><br><span class="line">                        alert(&apos;通信失败&apos;)</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &lt;/script&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">用户: &lt;input type=&quot;text&quot; id=&quot;user&quot;&gt;&lt;br&gt;</span><br><span class="line">密码: &lt;input type=&quot;password&quot; id=&quot;pass&quot;&gt;&lt;br&gt;</span><br><span class="line">&lt;input type=&quot;button&quot; value=&quot;注册&quot; id=&quot;reg_btn&quot;&gt;&lt;input type=&quot;button&quot; value=&quot;登陆&quot; id=&quot;login_btn&quot;&gt;</span><br><span class="line">&lt;/body&gt;</span><br></pre></td></tr></table></figure>
</li>
</ol>
<hr>
<h4 id="模块化"><a href="#模块化" class="headerlink" title="模块化"></a>模块化</h4><ol>
<li>系统模块:http querystring url</li>
<li><p>自定义模块</p>
<blockquote>
<ul>
<li>require 引入自定义模块时必须加<code>./</code>,可以不加<code>.js</code></li>
<li>exports 单个输出</li>
<li>module.exports={};批量输出</li>
<li>自定义模块可以统一放入node_modules里面,可以不加<code>./</code></li>
</ul>
</blockquote>
</li>
<li><p>包管理器</p>
<h4 id="express"><a href="#express" class="headerlink" title="express"></a>express</h4><p>基本用法</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">//1.创建服务</span><br><span class="line">const express = require(&apos;express&apos;);</span><br><span class="line">var server = express();</span><br><span class="line">//3. 处理用户请求server.user(&apos;地址&apos;,function(req,res)&#123;&#125;)</span><br><span class="line">server.use(&apos;/a.html&apos;, function (req, res) &#123;</span><br><span class="line">    res.send(&apos;abc&apos;);</span><br><span class="line">    res.end();</span><br><span class="line">&#125;);</span><br><span class="line">//2.监听</span><br><span class="line">server.listen(8080);</span><br></pre></td></tr></table></figure>
</li>
</ol>
<p>express保留了原生的功能,添加了一些方法(send),增强原有功能</p>
<ol>
<li>.get(‘/‘,function(req,res){});</li>
<li>.post(‘/‘,function(req,res){});</li>
<li>.use(‘/‘,function(req,res){});–get和post都可以<h5 id="express案例"><a href="#express案例" class="headerlink" title="express案例"></a>express案例</h5></li>
</ol>
<ul>
<li>设计接口<blockquote>
<p>请1求: /login?user=xxx&amp;pass=xxx <br><br>返回: {ok:true/false,msg:’结果’}</p>
</blockquote>
</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">const express = require(&apos;express&apos;);</span><br><span class="line">//依赖中间件</span><br><span class="line">const expressStatic = require(&apos;express-static&apos;);</span><br><span class="line">var server = express();</span><br><span class="line">server.listen(8080);</span><br><span class="line">var users = &#123;</span><br><span class="line">    &apos;blue&apos;: &apos;123123&apos;,</span><br><span class="line">    &apos;zhangsan&apos;: &apos;321321&apos;,</span><br><span class="line">    &apos;lishi&apos;: &apos;qwerqwer&apos;,</span><br><span class="line">&#125;;</span><br><span class="line">server.get(&apos;/login&apos;, function (req, res) &#123;</span><br><span class="line">    var user = req.query[&apos;user&apos;];</span><br><span class="line">    var pass = req.query[&apos;pass&apos;];</span><br><span class="line">    if (users[user] == null) &#123;</span><br><span class="line">        res.send(&#123;ok: false, msg: &apos;用户不存在&apos;&#125;);</span><br><span class="line">    &#125; else if (users[user] != pass) &#123;</span><br><span class="line">        res.send(&#123;ok: false, msg: &apos;密码错误&apos;&#125;);</span><br><span class="line">    &#125; else &#123;</span><br><span class="line">        res.send(&#123;ok: true, msg: &apos;登录成功&apos;&#125;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br><span class="line">//如果没有get到&apos;/login&apos;,则读取静态文件</span><br><span class="line">server.use(expressStatic(&apos;./www&apos;));</span><br></pre></td></tr></table></figure>
<h6 id="bodyParser"><a href="#bodyParser" class="headerlink" title="bodyParser"></a>bodyParser</h6><p>req.query–&gt;GET 无需额外的中间键 <br><br>req.body –&gt;POST 需要body-parser,分两步,只能解析post数据,不能解析post文件<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">//要先用bodyParser解析,然后才能用,body来自bodyParser</span><br><span class="line">server.use(bodyParser.urlencoded(&#123;&#125;));</span><br><span class="line">server.use(&apos;/&apos;, function (req, res) &#123;</span><br><span class="line">    console.log(req.body);//post</span><br><span class="line">&#125;);</span><br><span class="line">//&#123; user: &apos;1234&apos;, pass: &apos;1234&apos; &#125;</span><br></pre></td></tr></table></figure></p>
<p><code>bodyParser.urlencoded({})</code>有两个参数</p>
<ol>
<li>extended:true //扩展模式</li>
<li>limit: 2*1024*1024</li>
</ol>
<ul>
<li>bodyParser的实现原理  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">const querystring = require(&apos;querystring&apos;);</span><br><span class="line">module.exports = &#123;</span><br><span class="line">    aaa: function () &#123;</span><br><span class="line">        return function (req, res, next) &#123;</span><br><span class="line">            var str = &apos;&apos;;</span><br><span class="line">            req.on(&apos;data&apos;, function (data) &#123;</span><br><span class="line">                str += data;</span><br><span class="line">            &#125;);</span><br><span class="line">            req.on(&apos;end&apos;, function () &#123;</span><br><span class="line">                req.body = querystring.parse(str);</span><br><span class="line">                next();</span><br><span class="line">            &#125;);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h6 id="链式操作"><a href="#链式操作" class="headerlink" title="链式操作"></a>链式操作</h6><p>当server.use(‘/‘,function(req,res,<strong>next</strong>){<br>next();<br>})链式操作需要添加next</p>
<blockquote>
<p>server.use(function(){})如果不加路径,无论是哪种路径请求都可以接受</p>
</blockquote>
<h6 id="cookie-session"><a href="#cookie-session" class="headerlink" title="cookie session"></a>cookie session</h6><ul>
<li>cookie : 在浏览器保存一些数据,每次请求都会带回来,不安全,有限(4k)<ol>
<li>读取<ul>
<li><code>req.signedCookies</code></li>
<li><code>req.cookies</code></li>
</ul>
</li>
<li>发送<ul>
<li>指定路径:<code>res.cookie(&#39;user&#39;, &#39;yangze&#39;, {path: &#39;/aaa&#39;, maxAge: 30 * 24 * 3600 * 1000});</code> <br></li>
<li>加密:`req.secret = ‘sadfasdfwe’;<pre><code>res.cookie(&apos;user&apos;, &apos;yang&apos;, {signed: true});`
</code></pre></li>
<li>删除cookie<code>res.clearCookie(&#39;user&#39;)</code></li>
</ul>
</li>
</ol>
</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">const express = require(&apos;express&apos;);</span><br><span class="line">const cookieParser = require(&apos;cookie-parser&apos;);</span><br><span class="line">var server = express();</span><br><span class="line">server.listen(8080);</span><br><span class="line"></span><br><span class="line">server.use(cookieParser(&apos;sadfasdfwe&apos;));</span><br><span class="line">server.use(&apos;/&apos;, function (req, res) &#123;</span><br><span class="line"></span><br><span class="line">    req.secret = &apos;sadfasdfwe&apos;;</span><br><span class="line"></span><br><span class="line">    //res.cookie(名字, 值, &#123;path: &apos;/&apos;, maxAge: 毫秒, signed: true&#125;);</span><br><span class="line">    res.cookie(&apos;user&apos;, &apos;yang&apos;, &#123;signed: true&#125;);</span><br><span class="line"></span><br><span class="line">    //读取加密的cookie使用signedCookies</span><br><span class="line">    console.log(req.signedCookies);//签名版</span><br><span class="line">    console.log(req.cookies);       //未签名版</span><br><span class="line">    res.send(&apos;ok&apos;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<ul>
<li>session : 保存在服务端,安全性好,空间近乎无限,session基于cookie实现,不能独立存在,cookie中有一个session的id,服务器利用session id找到session的文件、读取、写入。。。有一个隐患：session劫持 <br><blockquote>
<p>cookie-session</p>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">server.use(cookieParser());&lt;br&gt;</span><br><span class="line">server.use(cookieSession(&#123;</span><br><span class="line">    name : &apos;sess&apos;,//给session起名字</span><br><span class="line">    keys : [&apos;aaa&apos;,&apos;bbb&apos;,&apos;ccc&apos;],</span><br><span class="line">    maxAge : 2 * 3600 * 1000</span><br><span class="line">&#125;));</span><br><span class="line">server.use(&apos;/&apos;,function(req, res)&#123;</span><br><span class="line">    req.session</span><br><span class="line">&#125;);</span><br><span class="line">// 删除session</span><br><span class="line">delete req.session</span><br></pre></td></tr></table></figure>
</blockquote>
</li>
</ul>
<h2 id="模板引擎"><a href="#模板引擎" class="headerlink" title="模板引擎"></a>模板引擎</h2><p>用来生成页面</p>
<ol>
<li>jade <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br></pre></td><td class="code"><pre><span class="line">//1.根据缩进,规定层级</span><br><span class="line">//2.属性放在()里面,逗号分隔</span><br><span class="line">//3.内容,直接在后面空格然后添加</span><br><span class="line">//4.style有两种写法,一种是普通属性写法,第二种是json格式写法</span><br><span class="line">//5.class可以用数组形式写</span><br><span class="line">//6.简写 div.box -- div#div1</span><br><span class="line">//7.div&amp;attributes(&#123;title:&apos;aaa&apos;,id:&apos;div1&apos;&#125;)</span><br><span class="line">//8.|为本,代表原样输出内容</span><br><span class="line">//9. . 代表所有下一级的内容,全部原样输出</span><br><span class="line">//10. script下使用include引入外部js文件</span><br><span class="line">//11. div #&#123;a+b&#125;</span><br><span class="line">//12.可以在renderFile里将style写成json格式,把class写成数组格式</span><br><span class="line">//13.可以将自己的class融入到class的数组里</span><br><span class="line">//14. 使用-var a=12;在jade中定义变量</span><br><span class="line">//15. 在jade中, span #&#123;a&#125; ,span=a 都是输出renderFile里的数据</span><br><span class="line">//16. 在jade中可以使用for,if,else,switch</span><br><span class="line">//17. 可以使用!=,将标签&lt;&gt;直接写入html</span><br><span class="line">html</span><br><span class="line">    head</span><br><span class="line">        style</span><br><span class="line">        script</span><br><span class="line">            include a.js</span><br><span class="line">        script.</span><br><span class="line">            window.onload = function () &#123;</span><br><span class="line">                var oBtn = document.getElementById(&apos;btn1&apos;);</span><br><span class="line">                oBtn.onclick = function () &#123;</span><br><span class="line">                    alert(&apos;aaa&apos;);</span><br><span class="line">                &#125;;</span><br><span class="line">            &#125;;</span><br><span class="line">        script(src=&apos;a.js&apos;)</span><br><span class="line">            |window.onload=function()&#123;</span><br><span class="line">            |var oBtn=document.getElementById(&apos;btn1&apos;);</span><br><span class="line">            |oBtn.onclick=funtion()&#123;</span><br><span class="line">            |   alert(&apos;aaa&apos;)</span><br><span class="line">            |&#125;;</span><br><span class="line">        link(href=&quot;a.css&quot;,ref=&quot;ref/stylesheet&quot;)</span><br><span class="line">    body</span><br><span class="line">        div(class=[&apos;aaa&apos;,&apos;left-warp&apos;,&apos;active&apos;])</span><br><span class="line">            ul</span><br><span class="line">                li hello</span><br><span class="line">                li</span><br><span class="line">                li</span><br><span class="line">        div(style=&#123;width:&apos;200px&apos;,height:&apos;200px&apos;,background:&apos;red&apos;&#125;)</span><br><span class="line">        div&amp;attributes(&#123;title:&apos;aaa&apos;,id:&apos;div1&apos;&#125;)</span><br><span class="line">         div 我的名字: #&#123;name&#125;</span><br><span class="line">         div(style=json)</span><br><span class="line">         div(class=arr class=&quot;active&quot;)</span><br><span class="line">         div</span><br><span class="line">             -var a=12;</span><br><span class="line">             -var b=12;</span><br><span class="line">             div 结果是: #&#123;a+b&#125;</span><br><span class="line">         div</span><br><span class="line">             -for(var i=0;i&lt;array.length;i++)</span><br><span class="line">                 div=array[i]</span><br><span class="line">         div</span><br><span class="line">             div!=content</span><br><span class="line">             div=content</span><br><span class="line">         div</span><br><span class="line">             -var a=19;</span><br><span class="line">             -if (a%2==0)</span><br><span class="line">                 div(style=&#123;background:&apos;red&apos;&#125;) 偶数</span><br><span class="line">             -else</span><br><span class="line">                 div(style=&#123;background:&apos;green&apos;&#125;) 奇数</span><br><span class="line">         div</span><br><span class="line">             -var a=1;</span><br><span class="line">             case a</span><br><span class="line">                 when 0</span><br><span class="line">                     div aaa</span><br><span class="line">                 when 1</span><br><span class="line">                     div bbb</span><br><span class="line">                 when 2</span><br><span class="line">                     div ccc</span><br><span class="line">                 default</span><br><span class="line">                     |没啦</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">const jade = require(&apos;jade&apos;);</span><br><span class="line">const fs = require(&apos;fs&apos;);</span><br><span class="line"></span><br><span class="line">var str = jade.renderFile(&apos;./view/1.jade&apos;, &#123;</span><br><span class="line">    pretty: true,</span><br><span class="line">    name: &quot;yangze&quot;,</span><br><span class="line">    json: &#123;width: &quot;200px&quot;, height: &quot;200px&quot;, background: &quot;red&quot;&#125;,</span><br><span class="line">    arr: [&apos;aaa&apos;, &apos;bbb&apos;, &apos;ccc&apos;],</span><br><span class="line">    content:&quot;&lt;div&gt;123&lt;/div&gt;&quot;</span><br><span class="line">&#125;);</span><br><span class="line">fs.writeFile(&apos;./build/1.html&apos;, str, function (err) &#123;</span><br><span class="line">    if (err) &#123;</span><br><span class="line">        console.log(&apos;fail&apos;);</span><br><span class="line">    &#125; else &#123;</span><br><span class="line">        console.log(&apos;seccess&apos;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
</li>
</ol>
<h6 id="jade案例"><a href="#jade案例" class="headerlink" title="jade案例"></a>jade案例</h6><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">doctype</span><br><span class="line">html</span><br><span class="line">    head</span><br><span class="line">        meta(charset=&quot;utf-8&quot;)</span><br><span class="line">        title jade测试页</span><br><span class="line">        style.</span><br><span class="line">            div &#123;</span><br><span class="line">                width: 100px;</span><br><span class="line">                height: 100px;</span><br><span class="line">                background-color: #999999;</span><br><span class="line">                line-height: 100px;</span><br><span class="line">                margin-top: 10px;</span><br><span class="line">                text-align: center;</span><br><span class="line">                float: left;</span><br><span class="line">            &#125;</span><br><span class="line">            div.last &#123;</span><br><span class="line">                clear: left;</span><br><span class="line">            &#125;</span><br><span class="line">    body</span><br><span class="line">        -var a=0</span><br><span class="line">        while a &lt; 12</span><br><span class="line">            if a % 4 == 0 &amp;&amp; a != 0</span><br><span class="line">                div.last #&#123;a++&#125;</span><br><span class="line">            else</span><br><span class="line">                div #&#123;a++&#125;</span><br></pre></td></tr></table></figure>
<ol start="2">
<li>ejs<br>非侵入式 <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">//1.&lt;%= name %&gt;</span><br><span class="line">//2.&lt;%= json.arr[0].name %&gt;</span><br><span class="line">//3.&lt;%= 12+5 %&gt;</span><br><span class="line">//4.&lt;%= &apos;asdfasdf&apos; %&gt;</span><br><span class="line">//5.&lt;% include 1.txt %&gt;</span><br><span class="line">&lt;!doctype html&gt;</span><br><span class="line">&lt;html lang=&quot;en&quot;&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">    &lt;% for (var i = 0;i &lt; json.arr.length;i++) &#123; %&gt;</span><br><span class="line">    &lt;div&gt;</span><br><span class="line">        用户名:</span><br><span class="line">        &lt;%= json.arr[i].user %&gt;</span><br><span class="line">        密码:</span><br><span class="line">        &lt;%= json.arr[i].pass %&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">    &lt;% &#125; %&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br><span class="line"></span><br><span class="line">const ejs = require(&apos;ejs&apos;);</span><br><span class="line">ejs.renderFile(&apos;./views/1.ejs&apos;, &#123;</span><br><span class="line">    json: &#123;</span><br><span class="line">        arr:[</span><br><span class="line">            &#123;user:&apos;blue&apos;,pass:&apos;12341234&apos;&#125;,</span><br><span class="line">            &#123;user:&apos;zhangsan&apos;,pass:&apos;12121212&apos;&#125;,</span><br><span class="line">            &#123;user:&apos;xiaoming&apos;,pass:&apos;23452345&apos;&#125;</span><br><span class="line">        ]</span><br><span class="line">    &#125;</span><br><span class="line">&#125;, function (err, data) &#123;</span><br><span class="line">    console.log(data);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
</li>
</ol>
<h2 id="Router"><a href="#Router" class="headerlink" title="Router"></a>Router</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">var r=express.Router();</span><br><span class="line">router1.use(&apos;/user_mod&apos;, r);</span><br><span class="line">router1.use(&apos;/user_reg&apos;, function ()&#123;&#125;);</span><br><span class="line">http://www.xxxx.com/user/user_mod</span><br><span class="line">http://www.xxxx.com/user/user_reg</span><br><span class="line">http://www.xxxx.com/user/user_login</span><br><span class="line"></span><br><span class="line">var router2=express.Router();</span><br><span class="line">server.use(&apos;/news&apos;, router2);</span><br><span class="line">http://www.xxxx.com/news/list</span><br><span class="line">http://www.xxxx.com/news/post</span><br><span class="line">http://www.xxxx.com/news/content</span><br><span class="line"></span><br><span class="line">var router3=express.Router();</span><br><span class="line">server.use(&apos;/item&apos;, router3);</span><br><span class="line">http://www.xxxx.com/item/buy</span><br><span class="line">http://www.xxxx.com/item/mod</span><br><span class="line">http://www.xxxx.com/item/del</span><br></pre></td></tr></table></figure>
<h2 id="multer"><a href="#multer" class="headerlink" title="multer"></a>multer</h2><blockquote>
<p>body-parser    解析post数据—&gt;application/x-www-form-urlencoded<br><br>multer        解析post文件—&gt;multipart/form-data</p>
</blockquote>
<h6 id="html"><a href="#html" class="headerlink" title="html"></a>html</h6><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;form action=&quot;http://localhost:8080&quot; method=&quot;post&quot; enctype=&quot;multipart/form-data&quot;&gt;</span><br><span class="line">    文件:&lt;input type=&quot;file&quot; name=&quot;f1&quot;&gt;</span><br><span class="line">    &lt;input type=&quot;submit&quot; value=&quot;上传&quot;&gt;</span><br><span class="line">&lt;/form&gt;</span><br></pre></td></tr></table></figure>
<h6 id="node-1"><a href="#node-1" class="headerlink" title="node"></a>node</h6><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">const express = require(&apos;express&apos;);</span><br><span class="line">const fs = require(&apos;fs&apos;);</span><br><span class="line">const static = require(&apos;express-static&apos;);</span><br><span class="line">const multer = require(&apos;multer&apos;);</span><br><span class="line">const pathLib = require(&apos;path&apos;);</span><br><span class="line">var server = express();</span><br><span class="line">var multerObj = multer(&#123;dest: &apos;./www/upload&apos;&#125;);</span><br><span class="line">server.use(multerObj.any(&apos;f1&apos;));</span><br><span class="line">server.post(&apos;/&apos;, function (req, res) &#123;</span><br><span class="line">    var newName = req.files[0].path + pathLib.parse(req.files[0].originalname).ext;</span><br><span class="line">    fs.rename(req.files[0].path, newName, function (err) &#123;</span><br><span class="line">        if (err) &#123;</span><br><span class="line">            res.send(&apos;wrong&apos;);</span><br><span class="line">        &#125; else &#123;</span><br><span class="line">            res.send(&apos;ok&apos;);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;);</span><br><span class="line">server.listen(8080);</span><br></pre></td></tr></table></figure>
<h1 id="consolidate"><a href="#consolidate" class="headerlink" title="consolidate"></a>consolidate</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">const consolidate = require(&apos;consolidate&apos;);</span><br><span class="line"></span><br><span class="line">//配置模板引擎</span><br><span class="line">//1.哪种模板引擎 使用view engine引擎来输出html</span><br><span class="line">server.set(&apos;view engine&apos;, &apos;html&apos;);</span><br><span class="line">//2.模板文件的位置</span><br><span class="line">server.set(&apos;views&apos;, &apos;模板目录&apos;);</span><br><span class="line">//3.输出什么东西</span><br><span class="line">server.engine(&apos;html&apos;, consolidate.ejs);</span><br><span class="line"></span><br><span class="line">//接受用户数据</span><br><span class="line">server.use(function (req, res)&#123;</span><br><span class="line">//渲染模板</span><br><span class="line">	res.render(&apos;模板文件&apos;, 数据);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<h2 id="MD5"><a href="#MD5" class="headerlink" title="MD5"></a>MD5</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">const crypto = require(&apos;crypto&apos;);</span><br><span class="line">module.exports = &#123;</span><br><span class="line">    md5: function (str) &#123;</span><br><span class="line">        var obj = crypto.createHash(&apos;md5&apos;);</span><br><span class="line">        obj.update(str);</span><br><span class="line">        return obj.digest(&apos;hex&apos;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

  </section>
  <footer class="post-footer">
    <!--
    <section class="author">
      <h4>Zia Yang</h4>
      <p></p>
    </section>
    -->
  </footer>
</article>

<nav class="pagination" role="pagination">
    
    <a class="newer-posts" href="/2017/01/06/数据库/">
        ← prev <!--数据库-->
    </a>
    
    <span class="page-number">•</span>
    
    <a class="older-posts" href="/2017/01/03/JavaScript语言精粹/">
        <!--JavaScript语言精粹--> next →
    </a>
    
</nav>


        </main>
        <footer id="footer">
            <section id="footer-message">&copy; 2018 Zia Yang. All rights reserved. Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>. <a href="https://github.com/guolin/crisp-hexo-theme" target="_blank">crisp</a> theme by <a href="guolin.github.io" target="_blank">Guo Lin</a>.</section>
        </footer>
    </body>
</html>


